---
name: code_review_guide
description: |
  代码审查（Code Review）规范和检查清单。
  适用于：审查代码、提供代码改进建议、评估代码质量。
  **这是一个参考文档，不是可执行工具。**
executable: false
---

## 代码审查检查清单

### 🔴 必须检查（阻断性问题）

#### 1. 安全性
- [ ] 无硬编码的密钥、密码、Token
- [ ] SQL 查询使用参数化，防止注入
- [ ] 用户输入已验证和清理
- [ ] 敏感数据已加密或脱敏
- [ ] 无不安全的反序列化

#### 2. 正确性
- [ ] 逻辑符合需求描述
- [ ] 边界条件已处理（空值、零值、极大值）
- [ ] 异常已正确捕获和处理
- [ ] 资源（文件、连接）已正确关闭
- [ ] 并发访问安全（如需要）

#### 3. 错误处理
- [ ] 不吞没异常（空 except/catch）
- [ ] 错误信息有意义，便于排查
- [ ] 关键操作有日志记录

### 🟡 应该检查（质量问题）

#### 4. 可读性
- [ ] 命名清晰，望文知意
- [ ] 函数/方法长度适中（建议 < 50 行）
- [ ] 复杂逻辑有注释说明
- [ ] 代码格式统一

#### 5. 可维护性
- [ ] 无重复代码（DRY 原则）
- [ ] 单一职责（一个函数做一件事）
- [ ] 魔法数字已提取为常量
- [ ] 依赖注入而非硬编码

#### 6. 性能
- [ ] 无 N+1 查询问题
- [ ] 大数据量操作使用分页/流式
- [ ] 昂贵计算有缓存机制
- [ ] 无不必要的循环嵌套

### 🟢 建议检查（优化建议）

#### 7. 测试
- [ ] 核心逻辑有单元测试
- [ ] 测试覆盖边界情况
- [ ] 测试可独立运行

#### 8. 文档
- [ ] 公共 API 有文档注释
- [ ] 复杂算法有说明
- [ ] README 已更新（如需要）

---

## 代码审查回复模板

```markdown
## Code Review 结果

### 🔴 必须修改
1. **[文件:行号]** 问题描述
   - 原因：为什么这是问题
   - 建议：如何修复

### 🟡 建议修改
1. **[文件:行号]** 问题描述
   - 建议：优化方案

### 🟢 表扬
- 代码的亮点

### 总结
- 总体评价
- 是否通过：✅ 通过 / ❌ 需修改后重审
```

---

## 常见问题速查

| 问题类型 | 示例 | 严重程度 |
|----------|------|----------|
| 密钥泄露 | `api_key = "sk-xxx"` | 🔴 阻断 |
| SQL 注入 | `f"SELECT * FROM users WHERE id={id}"` | 🔴 阻断 |
| 空异常处理 | `except: pass` | 🔴 阻断 |
| 未关闭资源 | `open(file)` 无 `with` | 🟡 重要 |
| 魔法数字 | `if status == 3:` | 🟡 重要 |
| 过长函数 | 函数超过 100 行 | 🟢 建议 |
